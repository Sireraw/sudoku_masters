<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Sudoku Solver</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .sudoku-grid { display: grid; grid-template-columns: repeat(9, 1fr); }
        .sudoku-cell { 
            width: 100%; height: 45px; text-align: center; font-size: 1.25rem; 
            font-weight: 600; border: 1px solid #d1d5db; background-color: #fff;
        }
        .row-group-separator { border-bottom: 3px solid #1f2937; }
        .col-group-separator { border-right: 3px solid #1f2937; }
        .initial-value { background-color: #f3f4f6; color: #4b5563; }
        input:focus { outline: 2px solid #4f46e5; z-index: 10; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-md bg-white rounded-xl shadow-2xl p-6">
        <h1 class="text-2xl font-bold text-gray-900 mb-2">Sudoku Solver</h1>
        <p class="text-sm text-gray-500 mb-6">Enter numbers (1-9) or leave blank for empty.</p>

        <div id="grid-container" class="border-2 border-gray-900">
            </div>

        <div class="mt-6 flex gap-2">
            <button id="solve-btn" class="flex-1 bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700">Solve</button>
            <button id="example-btn" class="bg-gray-200 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">Example</button>
            <button id="clear-btn" class="bg-red-50 px-4 py-2 rounded-lg font-semibold text-red-600 hover:bg-red-100">Clear</button>
        </div>

        <div id="status" class="mt-4 p-3 rounded-lg text-sm hidden"></div>
    </div>

    <script>
        const container = document.getElementById('grid-container');
        const status = document.getElementById('status');

        // Initialize 9x9 Grid
        function initGrid() {
            container.innerHTML = '';
            for (let r = 0; r < 9; r++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'sudoku-grid ' + (r % 3 === 2 && r !== 8 ? 'row-group-separator' : '');
                for (let c = 0; c < 9; c++) {
                    const input = document.createElement('input');
                    input.id = `c-${r}-${c}`;
                    input.maxLength = 1;
                    input.className = 'sudoku-cell ' + (c % 3 === 2 && c !== 8 ? 'col-group-separator' : '');
                    input.oninput = (e) => e.target.value = e.target.value.replace(/[^1-9]/g, '');
                    rowDiv.appendChild(input);
                }
                container.appendChild(rowDiv);
            }
        }

        async function solve() {
            const board = [];
            for (let r = 0; r < 9; r++) {
                const row = [];
                for (let c = 0; c < 9; c++) {
                    const val = document.getElementById(`c-${r}-${c}`).value;
                    row.push(parseInt(val) || 0);
                }
                board.push(row);
            }

            status.className = "mt-4 p-3 rounded-lg text-sm bg-blue-50 text-blue-700 block";
            status.textContent = "Solving...";

            try {
                const res = await fetch('/solve', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ board })
                });
                const data = await res.json();

                if (data.solved) {
                    data.solution.forEach((row, r) => {
                        row.forEach((val, c) => {
                            const el = document.getElementById(`c-${r}-${c}`);
                            if (!el.value) el.classList.add('text-indigo-600');
                            el.value = val;
                        });
                    });
                    status.className = "mt-4 p-3 rounded-lg text-sm bg-green-50 text-green-700 block";
                    status.textContent = "Solved successfully!";
                } else {
                    status.className = "mt-4 p-3 rounded-lg text-sm bg-red-50 text-red-700 block";
                    status.textContent = data.message || "No solution found.";
                }
            } catch (err) {
                status.textContent = "Error connecting to server.";
            }
        }

        document.getElementById('solve-btn').onclick = solve;
        document.getElementById('clear-btn').onclick = () => { initGrid(); status.classList.add('hidden'); };
        document.getElementById('example-btn').onclick = () => {
            const ex = [[5,3,0,0,7,0,0,0,0],[6,0,0,1,9,5,0,0,0],[0,9,8,0,0,0,0,6,0],[8,0,0,0,6,0,0,0,3],[4,0,0,8,0,3,0,0,1],[7,0,0,0,2,0,0,0,6],[0,6,0,0,0,0,2,8,0],[0,0,0,4,1,9,0,0,5],[0,0,0,0,8,0,0,7,9]];
            initGrid();
            ex.forEach((r, ri) => r.forEach((v, ci) => { if(v) { const el = document.getElementById(`c-${ri}-${ci}`); el.value = v; el.classList.add('initial-value'); } }));
        };

        initGrid();
    </script>
</body>
</html>